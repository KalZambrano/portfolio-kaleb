---
import ChevronIcon from "@/assets/icons/chevron-down.svg";
import { LANGUAGES } from "../i18n/ui";
import {
  getRouteFromUrl,
  useTranslatedPath,
  getLangFromUrl,
} from "../i18n/utils";

const route = getRouteFromUrl(Astro.url);
const lang = getLangFromUrl(Astro.url);
const translatePath = useTranslatedPath(lang);

const currentLocaleData = LANGUAGES[lang];
const otherLocales = Object.values(LANGUAGES).filter(
  (locale) => locale.code !== lang,
);
---

<div class="relative inline-block text-left z-50">
  <div
    class="rounded-xl text-sm font-medium
           bg-white/80 dark:bg-[#111]/80
           backdrop-blur-md
           border border-black/10 dark:border-white/10
           shadow-lg shadow-black/5 dark:shadow-black/40
           transition-all"
  >
    <!-- toggle oculto -->
    <input type="checkbox" id="lang-toggle" class="peer hidden" />

    <!-- label que actúa como botón -->
    <label
      for="lang-toggle"
      class="inline-flex items-center gap-2
             px-3 py-2 sm:px-4
             cursor-pointer select-none
             text-black dark:text-white
             hover:bg-black/5 dark:hover:bg-white/10
             rounded-xl
             transition-colors"
    >
      <currentLocaleData.flag />
      {currentLocaleData.name}
      <ChevronIcon
        class="size-4 ml-auto transition-transform peer-checked:rotate-180"
      />
    </label>

    <!-- menú desplegable -->
    <ul
      class="absolute left-0 mt-1 w-full
             rounded-xl
             bg-white/90 dark:bg-[#111]/90
             backdrop-blur-md
             border border-black/10 dark:border-white/10
             shadow-xl
             opacity-0 scale-95 pointer-events-none
             peer-checked:opacity-100 peer-checked:scale-100 peer-checked:pointer-events-auto
             transition-all duration-150 ease-out"
    >
      {
        otherLocales.map((locale) => (
          <li>
            <a
              class="flex items-center gap-2
                     px-3 py-2 sm:px-4
                     text-black dark:text-white
                     hover:bg-black/5 dark:hover:bg-white/10
                     rounded-lg
                     transition-colors"
              href={translatePath(`/${route ? route : ""}`, locale.code)}
            >
              <locale.flag />
              {locale.name}
            </a>
          </li>
        ))
      }
    </ul>
  </div>
</div>
